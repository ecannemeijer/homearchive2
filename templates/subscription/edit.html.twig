{% extends 'base.html.twig' %}

{% block title %}Bewerk {{ subscription.name }} - HomeArchive{% endblock %}

{% block body %}
<div class="container mx-auto px-4 py-8 max-w-3xl">
    <div class="mb-6">
        <a href="{{ path('subscription_show', {id: subscription.id}) }}" class="text-blue-600 hover:text-blue-700">
            <i class="fas fa-arrow-left"></i> Terug
        </a>
    </div>

    <div class="bg-white rounded-lg shadow-md p-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-6">
            <i class="fas fa-edit text-blue-600"></i> Bewerk Abonnement
        </h1>

        <form method="post" action="{{ path('subscription_edit', {id: subscription.id}) }}" enctype="multipart/form-data">
            <input type="hidden" name="_csrf_token" value="{{ csrf_token('subscription' ~ subscription.id) }}">

            <!-- Basic Info -->
            <div class="mb-6">
                <label class="block text-gray-700 font-semibold mb-2">Naam *</label>
                <input type="text" name="name" value="{{ subscription.name }}" required 
                       class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">Type *</label>
                    <select name="type" required class="w-full border border-gray-300 rounded px-3 py-2">
                        <option value="subscription" {{ subscription.type == 'subscription' ? 'selected' : '' }}>Abonnement</option>
                        <option value="insurance" {{ subscription.type == 'insurance' ? 'selected' : '' }}>Verzekering</option>
                    </select>
                </div>

                <div>
                    <label class="block text-gray-700 font-semibold mb-2">Categorie</label>
                    <select name="category" class="w-full border border-gray-300 rounded px-3 py-2">
                        <option value="">Selecteer een categorie</option>
                        {% for cat in categories %}
                            <option value="{{ cat.name }}" {{ subscription.category == cat.name ? 'selected' : '' }}>{{ cat.name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">Kosten (â‚¬) *</label>
                    <input type="number" name="cost" step="0.01" value="{{ subscription.cost }}" required 
                           class="w-full border border-gray-300 rounded px-3 py-2">
                </div>

                <div>
                    <label class="block text-gray-700 font-semibold mb-2">Frequentie *</label>
                    <select name="frequency" class="w-full border border-gray-300 rounded px-3 py-2">
                        <option value="monthly" {{ subscription.frequency == 'monthly' ? 'selected' : '' }}>Maandelijks</option>
                        <option value="yearly" {{ subscription.frequency == 'yearly' ? 'selected' : '' }}>Jaarlijks</option>
                    </select>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">Startdatum</label>
                    <input type="date" name="start_date" value="{{ subscription.startDate ? subscription.startDate|date('Y-m-d') : '' }}"
                           class="w-full border border-gray-300 rounded px-3 py-2">
                </div>

                <div>
                    <label class="block text-gray-700 font-semibold mb-2">Einddatum</label>
                    <input type="date" name="end_date" value="{{ subscription.endDate ? subscription.endDate|date('Y-m-d') : '' }}"
                           class="w-full border border-gray-300 rounded px-3 py-2">
                </div>
            </div>

            <div class="mb-6">
                <label class="block text-gray-700 font-semibold mb-2">Factuurdatum (dag van de maand)</label>
                <input type="number" name="billing_date" min="1" max="31" value="{{ subscription.billingDate }}"
                       class="w-full border border-gray-300 rounded px-3 py-2">
            </div>

            <div class="mb-6">
                <label class="flex items-center">
                    <input type="checkbox" name="is_monthly_cancelable" value="1" {{ subscription.isMonthlyCancelable ? 'checked' : '' }} class="mr-2">
                    <span class="text-gray-700">Maandelijks opzegbaar</span>
                </label>
            </div>

            <div class="mb-6">
                <label class="flex items-center">
                    <input type="checkbox" name="is_active" value="1" {{ subscription.isActive ? 'checked' : '' }} class="mr-2">
                    <span class="text-gray-700">Actief (wordt meegeteld in maandelijkse kosten)</span>
                </label>
            </div>

            <!-- Login Info -->
            <div class="border-t pt-6 mb-6">
                <h3 class="text-xl font-semibold text-gray-900 mb-4">Login Gegevens</h3>
                
                <div class="mb-4">
                    <label class="block text-gray-700 font-semibold mb-2">Website URL</label>
                    <input type="url" name="website_url" value="{{ subscription.websiteUrl }}"
                           class="w-full border border-gray-300 rounded px-3 py-2">
                </div>

                <div class="mb-4">
                    <label class="block text-gray-700 font-semibold mb-2">Gebruikersnaam</label>
                    <input type="text" name="username" value="{{ subscription.username }}"
                           class="w-full border border-gray-300 rounded px-3 py-2">
                </div>

                <div class="mb-4">
                    <label class="block text-gray-700 font-semibold mb-2">Wachtwoord</label>
                    <input type="password" name="password" 
                           class="w-full border border-gray-300 rounded px-3 py-2"
                           placeholder="Laat leeg om ongewijzigd te laten">
                    <p class="text-sm text-gray-500 mt-1">Laat leeg om het huidige wachtwoord te behouden</p>
                </div>
            </div>

            <!-- Notes -->
            <div class="mb-6">
                <label class="block text-gray-700 font-semibold mb-2">Notities</label>
                <textarea name="notes" rows="4" 
                          class="w-full border border-gray-300 rounded px-3 py-2">{{ subscription.notes }}</textarea>
            </div>

            <div class="mb-6">
                <label class="block text-gray-700 font-semibold mb-2">Herinnering voor verlenging (dagen)</label>
                <input type="number" name="renewal_reminder" value="{{ subscription.renewalReminder }}" min="1" 
                       class="w-full border border-gray-300 rounded px-3 py-2">
            </div>

            <!-- Documents Upload Section -->
            <div class="mb-6 pb-6 border-b border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900 mb-3">
                    <i class="fas fa-file-alt text-blue-600"></i> Extra Documenten Uploaden
                </h3>
                
                <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r mb-4">
                    <p class="text-sm text-blue-800">
                        <i class="fas fa-info-circle"></i> Upload extra documenten bij dit abonnement. 
                        Bestaande documenten blijven behouden.
                    </p>
                </div>

                <div>
                    <label for="documents" class="block text-gray-700 font-semibold mb-2">
                        <i class="fas fa-upload"></i> Bestanden Selecteren (Optioneel)
                    </label>
                    <input type="file" 
                           id="documents" 
                           name="documents[]" 
                           multiple
                           accept=".pdf,.jpg,.jpeg,.png,.gif,.webp"
                           class="w-full border border-gray-300 rounded-md px-4 py-2.5 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                    <p class="text-sm text-gray-500 mt-2">
                        PDF, JPG, PNG, GIF, WebP - Max 5MB per bestand
                    </p>
                </div>
            </div>

            <div class="flex gap-4">
                <button type="submit" 
                        class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold">
                    <i class="fas fa-save"></i> Opslaan
                </button>
                <a href="{{ path('subscription_show', {id: subscription.id}) }}" 
                   class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-800 px-6 py-3 rounded-lg font-semibold text-center">
                    Annuleren
                </a>
            </div>
        </form>
    </div>
</div>
{% endblock %}
